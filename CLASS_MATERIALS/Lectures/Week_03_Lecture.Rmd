---
title: "Plotting, visualization, and linear regression"
author: "Peter Ralph"
date: "8 October -- Advanced Biological Statistics"
---

```{r setup, include=FALSE}
fig.dim <- 4
knitr::opts_chunk$set(fig.width=2*fig.dim,
                      fig.height=fig.dim,
                      fig.align='center')
set.seed(23)
library(tidyverse)
library(matrixStats)
options(mc.cores = parallel::detectCores())
```



# Correlation

## What else predicts price?

Whimsically, what about number of characters in the house rules?

```{r house_rules}
airbnb$house_rules <- as.character(airbnb$house_rules)
hist(nchar(airbnb$house_rules), breaks=40)
```

##

```{r lm_price}
plot(price ~ nchar(house_rules), data=airbnb)
abline(coef(lm(price ~ nchar(house_rules), data=airbnb)), col='red', lwd=2)
```

## `lm()`

```{r summary_lm}
summary(lm(price ~ nchar(house_rules), data=airbnb))
```

. . .

How do we do a permutation test of *this* result?


# Two variables

## "Second, look at the data"

```{r biplot}
n <- 200
tz <- data.frame(t=seq(0, 10, length.out=n))
tz$z <- cos(tz$t) + rnorm(n)/4

(ggp <- ggplot(tz, mapping=aes(x=t, y=z)) + xlab("time") + ylab("value") + 
    geom_point())
```

## "Smooths"

```{r biplot2}
(ggp +
    geom_smooth(method='loess', formula=y ~ x, span=0.2))
```

. . .

That line is produced by `loess`, which does *local weighted regression*.


## Lines?

```{r biplot3}
(ggp +
    geom_smooth(method='lm', formula=y ~ x))
```

Is this a good idea?


# Correlation and regression

## Two variables

Now consider the results of an experiment:
green fluorescent protein (GFP) concentration
at eight temperatures ([data](../Datasets/gfp_temp.tsv)):

```{r twovars}
(xy <- read.table("../Datasets/gfp_temp.tsv")
```

## Correlation?

```{r cor}
cor(xy$temp, xy$gfp)
```

. . .

![xkcd:552](images/xkcd_correlation.png)

*Correlation doesn't imply causation,
but it does waggle its eyebrows suggestively and gesture furtively
while mouthing "look over there".*

## Have a look

```{r xyplot, fig.width=fig.dim}
(ggplot(xy, mapping=aes(x=temp, y=gfp)) + xlab("temperature") + ylab("GFP concentration")
    + geom_point()
    + geom_smooth(method='lm', se=FALSE))
```

(on board: how's least-squares regression work)



